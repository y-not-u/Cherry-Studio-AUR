name: Release to AUR

on:
  push:
    branches:
      - master

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          path: source-repo
      - name: Checkout AUR repository
        uses: actions/checkout@v4
        with:
          repository: cherry-studio-bin
          ref: master
          ssh-key: ${{ secrets.AUR_SSH_KEY }}
          ssh-user: aur
          path: aur-repo
          github-server-url: https://aur.archlinux.org
      - name: Update PKGBUILD or other files
        run: |
          cp -r --exclude='.github' source-repo/* aur-repo/

      - name: Validate package
        uses: heyhusen/archlinux-package-action@v2
        with:
          path: aur-repo
          flags: ""
          namcap: false
          srcinfo: true
      - name: Commit and push to AUR
        run: |
          cd aur-repo
          git add .
          git commit -m "chore: bump version"
          git push
